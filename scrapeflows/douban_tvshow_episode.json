{
  "type": "tvshow_episode",
  "site": "douban.com",
  "steps": [
    {
      "http": {
        "url": "https://www.douban.com/search?cat=1002&q={title}",
        "method": "GET",
        "headers": {
          "Referer": "https://www.douban.com/",
          "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36"
        },
        "result": "metadata"
      }
    },
    {
      "collect": {
        "source": "metadata",
        "into": {
          "ids": "re_matches: 电视剧].*?sid:\\s*(\\d+)\\s*,"
        }
      }
    },
    {
      "loop": {
        "source": "ids",
        "item": "id",
        "steps": [
          {
            "http": {
              "url": "https://movie.douban.com/subject/{id}/",
              "method": "GET",
              "headers": {
                "Host": "movie.douban.com",
                "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36"
              },
              "result": "subject"
            }
          },
          {
            "collect": {
              "source": "subject",
              "from": "xp_text: .//script[@type='application/ld+json']",
              "into": {
                "episode": {
                  "title": "xp_text: ./name",
                  "tagline": "",
                  "original_title": "",
                  "original_available": "xp_text: ./datePublished",
                  "certificate": "",
                  "genre": "xp_texts: ./genre/*",
                  "actor": "xp_texts: ./actor//name",
                  "writer": "xp_texts: ./author//name",
                  "director": "xp_texts: ./director//name",
                  "extra": {
                    "[plugin_id]": {
                      "tvshow": {
                        "title": "xp_text: ./name",
                        "original_available": "xp_text: ./datePublished",
                        "extra": {
                          "[plugin_id]": {
                            "poster": "xp_texts: ./image",
                            "backdrop": "xp_texts: ./image"
                          }
                        }
                      },
                      "rating": {
                        "[plugin_id]": "xp_text: .//ratingValue"
                      },
                      "poster": "xp_texts: ./image"
                    }
                  }
                }
              }
            }
          },
          {
            "collect": {
              "source": "subject",
              "into": {
                "episode": {
                  "summary": "xp_text: .//span[@property='v:summary']",
                  "extra": {
                    "[plugin_id]": {
                      "tvshow": {
                        "summary": "xp_text: .//span[@property='v:summary']"
                      }
                    }
                  }
                }
              }
            }
          },
          {
            "collect": {
              "source": "$parent",
              "into": {
                "episode": {
                  "season": "get: season",
                  "episode": "get: episode"
                }
              }
            }
          },
          {
            "replace": {
              "source": "episode",
              "pattern": "(.+/photo)/s_ratio_poster/(public/.+)",
              "replacement": "\\1/m/\\2"
            }
          },
          {
            "retval": "episode"
          }
        ]
      }
    }
  ]
}